---
layout: mypost
title: å¦‚ä½•å‘å¸ƒä¸€ä¸ªè‡ªå·±çš„NPMåŒ…
categories: [å‰ç«¯]
---

æœ€è¿‘åœ¨å†™ä»£ç æ—¶å‡ ä¸ªä»ç½‘ä¸Šæœçš„ä¸€äº›å·¥å…·æ–¹æ³•æ‹·è¿‡æ¥æ‹·è¿‡å»éå¸¸éº»çƒ¦ï¼Œç”±äºä¸è¡Œå¼•å…¥ä¸€äº›å¤§è€Œå…¨çš„å·¥å…·åº“å¢åŠ ä½“ç§¯ï¼Œäºæ˜¯å°±æƒ³è‡ªå·±æ˜¯å¦å¯ä»¥å‘å¸ƒä¸€ä¸ª npm åŒ…ä¾›è‡ªå·±åœ¨å¤šä¸ªé¡¹ç›®é—´å¼•ç”¨

[é¡¹ç›®åœ°å€](https://github.com/TMaize/common-kit)

## ä»£ç ç¼–å†™

åˆå§‹åŒ–é¡¹ç›®ï¼Œæ ¹æ®æç¤ºå¡«å†™ä¿¡æ¯ï¼Œå»ºè®®å…ˆåœ¨ github ä¸Šå»ºå¥½é¡¹ç›®å†æ‰§è¡Œï¼Œå› ä¸ºä¸€äº›ä¿¡æ¯ä¼šè‡ªåŠ¨æ›¿ä½ è¡¥ä¸Š

```sh
npm init
```

ä¸ºäº†ä»£ç çš„é€šç”¨æ€§ï¼Œå½“ä¸ä½¿ç”¨ webpack ç­‰å·¥å…·å‘å¸ƒ dist åŒ…çš„è¯ï¼Œé‚£ä¹ˆåœ¨ä»£ç å†…å¼•ç”¨åº“çš„è¯æœ€å¥½ä½¿ç”¨ Nodejs æ”¯æŒçš„ CommonJS (require)è§„èŒƒæ¥å¯¼å…¥ï¼Œä»è€Œé¿å…åˆ«äººä½¿ç”¨ä½ çš„åº“è¿˜éœ€è¦å†å®‰è£… Babelã€‚åœ¨å¯¼å‡ºæ¨¡å—æ—¶å¯ä»¥åšå…¼å®¹åŒæ—¶æ”¯æŒ ES Module å’Œ CommonJSã€‚

```js
const utf8 = require('../utf8/index.js')
// ...
module.exports = {
  encode: btoa,
  decode: atob
}
```

å…¼å®¹å¤šç§å¯¼å‡ºçš„å†™æ³•

```js
!(function (t, r) {
  'object' == typeof exports && 'object' == typeof module
    ? (module.exports = r())
    : 'function' == typeof define && define.amd
    ? define('kit', [], r)
    : 'object' == typeof exports
    ? (exports.kit = r())
    : (t.kit = r())
})(this, function () {
  return {
    // base64: base64
  }
})
```

ä»£ç ç¼–å†™åˆ°è¿™é‡Œå°±å®Œæˆäº†ï¼Œå‘å¸ƒä¸Šå»å¯ä»¥è¢«å…¶ä»–åº“å¼•ç”¨äº†ï¼Œè€Œä¸”è¿˜æ˜¯æŒ‰éœ€åŠ è½½çš„ï¼Œç”¨åˆ°é‚£ä¸ªå°±å»å¼•å…¥é‚£ä¸ªã€‚ä½†æ˜¯æœ‰æ—¶å€™ï¼Œé™¤äº†åœ¨ Node é¡¹ç›®ä¸­å¼•ç”¨ï¼Œè¿˜éœ€è¦åœ¨æµè§ˆå™¨ä¸­è¿›å…¥ js æ–‡ä»¶ï¼Œè¿™æ—¶å€™å°±è¦ç”¨åˆ° webpack äº†

```sh
npm install webpack -D
npm install webpack-cli -D
```

å¯ä»¥æ–°å»ºä¸€ä¸ª`index.js`æ–‡ä»¶ï¼Œç„¶åå¼•å…¥æ‰€æœ‰çš„ js æŒ‚åˆ° window ä¸Šï¼Œå†ä½¿ç”¨ webpack æ‰“åŒ…è¿™ä¸ªæ–‡ä»¶ï¼Œå°±ç”Ÿæˆäº†å¯ä»¥åœ¨æµè§ˆå™¨ä¸­ä½¿ç”¨çš„ç‰ˆæœ¬äº†

```js
const base64 = require('./lib/base64/index')
const utf8 = require('./lib/utf8/index')
const md5 = require('./lib/md5/index')

window.kit = {
  base64: base64,
  utf8: utf8,
  md5: md5
}
```

webpack é…ç½®å¦‚ä¸‹ï¼Œç„¶ååœ¨ package.json ä¸­æ·»åŠ  build è„šæœ¬`webpack --config ./webpack.conf.js`ç„¶åæ‰§è¡Œ`npm run build`å°±å¯ä»¥äº†,å¦‚æœä½ å¸Œæœ›ä»£ç å¯ä»¥åœ¨ä½ç‰ˆæœ¬è®¾å¤‡ä¸Šè¿è¡Œå¯ä»¥ä½¿ç”¨ bable æ’ä»¶è¿›è¡Œ polyfill

```js
module.exports = {
  mode: 'production',
  entry: './index.js',
  output: {
    filename: './kit.min.js'
  }
}
```

## cli

ä¸€äº› cli ç¨‹åºå…¨å±€å®‰è£…åæ˜¯å¯ä»¥ç›´æ¥é€šè¿‡å‘½ä»¤è¡Œå»æ‰§è¡Œçš„ï¼Œæ¯”å¦‚`npm install -g hexo-cli`ã€‚å…¶å®åªè¦åœ¨`package.json`é…ç½®å¥½ä¸‹å°±å¥½äº†

```json
{
  "bin": {
    "hexo": "./bin/hexo"
  }
}
```

å¦å¤–æ–‡ä»¶çš„ç¬¬ä¸€è¡Œä¸€å®šè¦å†™ä¸Šè§£é‡Šå™¨ï¼Œä¸ç„¶çš„è¯ä¼šç›´æ¥æ‰§è¡Œ js æ–‡ä»¶å°±æŠ¥é”™äº†ã€‚è¿™ä¹Ÿè¯´æ˜ npm ä¹Ÿæ˜¯å¯ä»¥æ‰˜ç®¡äºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶çš„

```
#!/usr/bin/env node
```

## æ‰“åŒ…è§„èŒƒ

ä¸Šé¢çš„æ‰“åŒ…è¿˜æ˜¯æœ‰é—®é¢˜çš„ï¼Œå…¨å±€å˜é‡æ˜¯ç›´æ¥ç»‘å®šåœ¨ window ä¸Šçš„ï¼Œéš¾å…ä¼šæœ‰å˜é‡åçš„å†²çªï¼Œä¸”ä¸ç¬¦åˆæ¨¡å—åŒ–çš„è§„èŒƒï¼Œå…¶å® webpack åœ¨æ‰“åŒ…çš„æ—¶å€™æ˜¯å¯ä»¥è®¾ç½®è¾“å‡ºä¸ºå„ç§è§„èŒƒä¸‹çš„æ–‡ä»¶çš„

è°ƒæ•´ index.js æ–‡ä»¶ï¼Œè®¾ç½®ä¸ºæ ‡å‡†å¯¼å‡º

```js
const base64 = require('./lib/base64/index')
const utf8 = require('./lib/utf8/index')
const md5 = require('./lib/md5/index')

module.exports = {
  base64: base64,
  utf8: utf8,
  md5: md5
}
```

è°ƒæ•´ webpack é…ç½®,è¿™æ ·æ‰“åŒ…åä¼šæŠŠ kit å˜é‡ç»‘å®šåˆ° this ä¸Šï¼Œé€šè¿‡`<script>`å¼•ç”¨åå°±ç›´æ¥ç»‘å®šåˆ° window ä¸Šäº†ã€‚å¦‚æœä½ ä½¿ç”¨äº† requireJS ç­‰å¼•ç”¨ï¼Œè¿˜å¯ä»¥é‡å‘½åå¯¼å‡ºçš„å˜é‡åç§°

```js
module.exports = {
  mode: 'production',
  entry: './index.js',
  output: {
    filename: './kit.min.js',
    library: 'kit',
    libraryTarget: 'umd',
    globalObject: 'this',
    umdNamedDefine: true
  }
}
```

## æµ‹è¯•

ä¸€ä¸ªå¥½çš„é¡¹ç›®å¿…é¡»è¦æœ‰è¶³å¤Ÿçš„æµ‹è¯•ï¼Œç”±äºè¿™æ˜¯ä¸€ä¸ªè‡ªå·±ç”¨çš„åº“ï¼Œå°±ç”¨ä¸‹ nodejs è‡ªå¸¦çš„ assertï¼Œæ²¡æœ‰å»ä½¿ç”¨ç¬¬ä¸‰æ–¹çš„æµ‹è¯•åº“

è°ƒæ•´ package.json è„šæœ¬,æ–°å¢`"test": "node test.js"`,ç„¶åæ‰§è¡Œ`npm test`æ—¢å¯ä»¥äº†ï¼Œå¦‚æœæµ‹è¯•ä¸é€šè¿‡ä¼šç»ˆæ­¢æµ‹è¯•å¹¶æŠ¥é”™

test.js æ–‡ä»¶

```js
const kit = require('./index')
const assert = require('assert')

let rawStr = 'ä½ å¥½ kit'
let base64Str = '5L2g5aW9IGtpdA=='

assert(base64Str === kit.base64.encode(rawStr), 'base64.encode')
assert(rawStr === kit.base64.decode(base64Str), 'base64.decode')
```

å½“æµ‹è¯•æ–‡ä»¶è¿‡å¤šæ—¶ï¼Œå¯ä»¥ä»¥è€ƒè™‘æŠŠæµ‹è¯•é¡¹ç›®å•ç‹¬å½¢æˆä¸€ä¸ªé¡¹ç›®ï¼Œè¿™å°±æ¶‰åŠåˆ°å¦‚ä½•åœ¨æœ¬åœ°è°ƒè¯• npm åŒ…äº†

ä¸€ç§æ–¹å¼æ˜¯ä½¿ç”¨ [npm link](https://docs.npmjs.com/cli/v7/commands/npm-link) å‘½ä»¤å°†é¡¹ç›®ä¸´æ—¶æ”¾åˆ°å…¨å±€ node_modules ç›®å½•é‡Œé¢ï¼Œè¿˜æœ‰ä¸€ç§æ–¹å¼æ˜¯ npm æ˜¯æ”¯æŒå®‰è£…æœ¬åœ°åŒ…çš„ ğŸ˜

```
npm install -S F:/npm-hello
npm install -S ../npm-hello
```

```json
{
  "dependencies": {
    "@tmaize/hello": "file:F:/npm-hello",
    "@tmaize/hello": "file:../npm-hello"
  }
}
```

## å‘å¸ƒé‚£äº›æ–‡ä»¶

é»˜è®¤æƒ…å†µä¸‹ï¼Œé™¤äº† node_modules å’Œ .gitignore ä¸­é…ç½®çš„ä¸ä¼šå‘å¸ƒï¼Œå…¶ä½™çš„éƒ½ä¼šå‘å¸ƒä¸Šå»ï¼Œè¿™æ˜¾ç„¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ï¼Œå› ä¸ºæœ‰ä¸€äº›é…ç½®æ–‡ä»¶æ˜¯è¦æäº¤çš„ä»“åº“çš„ï¼Œä½†æ˜¯ä¸éœ€è¦å‘å¸ƒçš„ã€‚å¯ä»¥é€šè¿‡è®¾ç½®é»‘ç™½åå•æ¥è§£å†³è¿™ä¸ªé—®é¢˜

é»‘åå•ï¼š`.npmignore`æ–‡ä»¶ï¼Œè§„åˆ™åŒ`.gitignore`

ç™½åå•ï¼šé…ç½®é‚£äº›å‘å¸ƒï¼Œä¼˜å…ˆçº§æœ€é«˜ï¼Œæ¨èä½¿ç”¨è¿™ä¸ªï¼Œå› ä¸ºä»–æ˜¯å†™åœ¨ package.json æ–‡ä»¶ä¸­çš„

```json
{
  "files": ["dist", "lib", "LICENSE", "README.md", "package.json"]
}
```

## å‘å¸ƒ

å»[npmjs](https://www.npmjs.com/)ä¸Šæ³¨å†Œä¸€ä¸ªè´¦å·ï¼Œç•™æ„ä¸‹è‡ªå·±çš„é‚®ç®±ç‚¹ä¸‹éªŒè¯é“¾æ¥ï¼Œä¸ç„¶åé¢çš„å‘å¸ƒä¼šæŠ¥é”™

å–ä¸€ä¸ªåå­—ï¼Œç„¶åæœç´¢ä¸‹æœ‰æ²¡æœ‰è¢«å ç”¨ï¼Œç„¶åæ²¡æœ‰è¢«å ç”¨ï¼Œå°±å¯ä»¥ä½¿ç”¨äº†(æœ‰ç§åƒæŠ¢æ³¨åŸŸåçš„æ„Ÿè§‰)

å¦å¤–å¦‚æœå®åœ¨æ˜¯ä¸æƒ³æ”¹åå­—ï¼Œå¯ä»¥å‘å¸ƒ scoped åŒ…ï¼Œè¿™ç§ç»å¯¹ä¸ä¼šè¢«å ç”¨çš„ï¼Œå› ä¸ºåŒ…åè§„åˆ™æ˜¯`@user/pkg`,å’Œä½ çš„ç”¨æˆ·åç»‘å®šçš„

æ³¨æ„ï¼šè‹¥ç™»é™†å¤±è´¥å¯ä»¥æ‰§è¡Œ`npm config get registry`æ£€æŸ¥æ˜¯å¦ä¸ºå®˜æ–¹æº`https://registry.npmjs.org/`,å¦‚æœä¸æ˜¯å¯ä»¥åˆ°`C:\Users\name\.npmrc`ä¸‹ä¸´æ—¶æ³¨é‡Šé…ç½®çš„ registry

```
npm adduser # ç™»é™†
npm logout  # é€€å‡º
npm whoami  # æ˜¾ç¤ºå½“å‰ç™»é™†ç”¨æˆ·
npm publish # å‘å¸ƒ ,æç¤ºç‰ˆæœ¬å­˜åœ¨éœ€è¦æ‰‹åŠ¨æ›´æ–°package.jsonä¸­çš„ç‰ˆæœ¬
npm deprecate pkgname@x.x.x # æ ‡è¯†æŸä¸ªç‰ˆæœ¬è¿‡æ—¶
npm unpublish pkgname@x.x.x # åˆ é™¤ï¼Œåˆ é™¤çš„ç‰ˆæœ¬24å°æ—¶åæ–¹å¯é‡å‘ï¼Œåªæœ‰å‘å¸ƒ72å°æ—¶ä¹‹å†…çš„åŒ…å¯ä»¥åˆ é™¤
npm view pkgname versions # æŸ¥çœ‹æ‰€æœ‰ç‰ˆæœ¬
```

å½“å‘å¸ƒåˆ° npm ä»“åº“åï¼Œå¯ä»¥ä½¿ç”¨[unpkg](https://unpkg.com/browse/vue/)æ¥è®¿é—®é‡Œé¢çš„é™æ€æ–‡ä»¶ï¼Œè¿˜å¯ä»¥äº«å—åˆ° CDN åŠ é€ŸæœåŠ¡

å…³äºç‰ˆæœ¬çš„ä¸€äº›è¯´æ˜

![01](01.jpg)

## å‚è€ƒ

[npm å‘å¸ƒåŒ…æ•™ç¨‹ï¼ˆäºŒï¼‰ï¼šå‘å¸ƒåŒ…](https://segmentfault.com/a/1190000017463371)

[package.json | npm Docs](https://docs.npmjs.com/cli/v7/configuring-npm/package-json#workspaces)
